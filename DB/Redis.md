# Redis

### 소개

- In-memory 방식의 DB
- DB, 캐시, 메세지 브로커, 스트리밍 엔진
- 트랜잭션, Pub/Sub, Lua scripting, 만료기한이 있는 데이터, LRU, 자동 장애 조치
- 다양한 자료구조
- ANSI C 로 작성되어 있으며 Linux같은 POSIX 방식 시스템에서 작동함

### Memurai

- 공식적으로 Windows는 지원하지 않음
- https://github.com/microsoftarchive/redis/releases/tag/win-3.0.504 다음과 같이 MS에서 지원을 했었으나 16년 이후로 업데이트가 멈춤
- Memurai는 Redis의 6.2.6 기반으로 생성된 시스템으로 windows에서만 사용 가능

### Memcached

- 분산 메모리 방식의 캐시 시스템을 위한 저장소
- Key-Value 형태로 저장하며, 데이터당 1MB 까지 저장 가능
- 분산 및 다중 스레드 아키텍처로 손쉽게 확장 가능
- 빠르고 일관된 성능을 제공함
- 트랜잭션 미지원하지만 내부 처리 로직으로 Atomic한 것을 보장해줌

### Data Types

- String
  - Redis의 기본 밸류
  - Binary-Safe함
  - JPEG image나 직렬화된 Ruby Object도 저장 가능
  - 512 MB의 길이까지 저장 가능
- List
  - LPUSH와 RPUSH를 지원
  - (2^32) - 1의 길이까지 원소를 가질 수 있음
- Set
  - 데이터가 얼마큼 있든 O(1)에 데이터의 추가, 제거 및 테스트가 가능
  - (2^32) -1 까지 원소를 보유가능
- Hash
- Sorted Set
- Bitmap
- Streams

### Single-Thread

- 레디스 클라이언트는 원래 싱글 스레드이지만 6.0부터 멀티 스레드를 지원함
- 레디스 서버는 멀티 스레드
- 기본적으로 클라이언트에서 Read/Write 행위는 싱글 스레드이지만 6.0부터는 멀티 스레드로도 처리 가능
- 싱글 스레드 환경에서 O(N)의 명령어는 가급적이면 사용할 때 주의할 것

### Copy on Write

- 레디스는 Copy on Write 방식으로, 쓰기 작업을 시작하는 순간 원본 데이터를 fork를 수행하여 복사한 뒤 쓰기 작업을 실행한다
- 그렇기 때문에 Redis에서는 한 번에 큰 작업을 하는 것보다는 여러 개로 분산해서 작업하는 것을 권장하고 있다.
  (**8GB \* 4** vs 32GB)

### Redis Persistent

- Redis는 휘발성 Memory에 데이터를 보관하기 때문에 데이터를 영구적으로 보관하기 위해 디스크에 저장하는 과정을 가짐
- 싱글 스레드이기에 단순 SAVE를 진행하는 경우에는 다른 명령어 수행에 제한이 생김
- 백그라운드에서 저장하는 BGSAVE를 진행하는 경우, 메인 프로세스랑 분리된 별도의 프로세스에서 동작함
- 최악의 경우 기존 사용 메모리만큼 메모리가 추가로 필요하기 때문에 여유 메모리 공간이 많이 필요함
- Redis는 다음과 같은 옵션을 제공
  - RDB (Redis Database) : 지정된 간격마다 데이터 세트의 지정 시간을 스냅숏을 수행
  - AOF : 모든 쓰기 작업을 기록하여, 서버 시작 시 이 기록을 재생하여 원래 데이터 세트를 구성
  - No Persistence
  - RDB + AOF
- RDB
  - 데이터 복구할 때 매우 유용
  - 다양한 버전의 데이터 세트로 손쉽게 복원이 가능
  - AOF 대비 더 빠르게 재시작 가능
  - Redis 작동을 멈춘 경우, 데이터 손실이 더 많음
  - fork()를 더 자주하기 때문에 데이터 세트가 큰 경우 시간이 오래 걸릴 수 있음
- AOF
  - 데이터 손실에 대해서 더 안전함
  - 쓰기 작업만 진행하기에 빠르게 처리 가능
  - 일반적으로 동일한 데이터 세트에 대해서 RDB보다 더 많은 용량을 차지함
